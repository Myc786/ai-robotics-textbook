# Data Model: FastAPI Backend with OpenAI Agent and Qdrant Retrieval

**Feature**: 005-fastapi-openai-qdrant
**Created**: 2025-12-19
**Status**: Complete

## Core Entities

### Question
- **Description**: A user's query about the book content
- **Fields**:
  - `question` (string): The text of the user's question
- **Validation**:
  - Required field
  - Minimum length: 1 character
  - Maximum length: 1000 characters

### Response
- **Description**: The system's answer to a user's question
- **Fields**:
  - `answer` (string): The AI-generated answer to the question
  - `sources` (array of strings): URLs or identifiers of the sources used
- **Validation**:
  - `answer` is required
  - `sources` is required and must be an array
  - Each source URL must be a valid URL format

### ContentChunk
- **Description**: A segment of content retrieved from the vector database
- **Fields**:
  - `id` (string): Unique identifier for the content chunk
  - `text` (string): The actual content text
  - `source_url` (string): URL or identifier of the original source
  - `similarity_score` (float): Similarity score from vector search
- **Validation**:
  - All fields are required
  - `similarity_score` must be between 0 and 1

### APIRequest
- **Description**: Represents an incoming API request to the backend
- **Fields**:
  - `question` (string): The question submitted by the user
- **Validation**:
  - Follows the same validation as the Question entity

### APIResponse
- **Description**: Represents an outgoing API response from the backend
- **Fields**:
  - `answer` (string): The answer generated by the AI agent
  - `sources` (array of strings): Source citations for the answer
- **Validation**:
  - Follows the same validation as the Response entity

## State Transitions

### Question Processing Flow
1. **Received**: Question is received via POST /chat endpoint
2. **Processed**: Question is embedded and searched in Qdrant
3. **Answered**: OpenAI agent generates response using retrieved content
4. **Responded**: Response is returned to the client

## Relationships

- A single `Question` generates one `Response`
- A `Response` is composed of information from multiple `ContentChunk` entities
- Each `APIRequest` maps to one `Question`
- Each `APIResponse` maps to one `Response`